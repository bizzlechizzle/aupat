{
  "version": "0.1.1",
  "last_updated": "2025-11-15",
  "description": "Videos table schema - video files with metadata and hardware categorization",
  "table_name": "videos",

  "schema": {
    "columns": [
      {
        "name": "vid_sha256",
        "type": "TEXT",
        "constraints": ["UNIQUE", "NOT NULL"],
        "description": "SHA256 hash of video file - full 64 chars, vid_sha8 computed as sha256[:8]"
      },
      {
        "name": "vid_name",
        "type": "TEXT",
        "constraints": ["NOT NULL"],
        "description": "Current filename - format: loc_uuid8-vid_sha8.ext or loc_uuid8-sub_uuid8-vid_sha8.ext"
      },
      {
        "name": "vid_loc",
        "type": "TEXT",
        "constraints": ["NOT NULL"],
        "description": "Current video location (absolute path)"
      },
      {
        "name": "original",
        "type": "INTEGER",
        "constraints": [],
        "description": "Boolean flag: original unprocessed file (1=true, 0=false, NULL=unknown)"
      },
      {
        "name": "camera",
        "type": "INTEGER",
        "constraints": [],
        "description": "Boolean flag: DSLR/mirrorless camera (1=true, 0=false, NULL=unknown)"
      },
      {
        "name": "drone",
        "type": "INTEGER",
        "constraints": [],
        "description": "Boolean flag: drone camera (1=true, 0=false, NULL=unknown)"
      },
      {
        "name": "phone",
        "type": "INTEGER",
        "constraints": [],
        "description": "Boolean flag: smartphone camera (1=true, 0=false, NULL=unknown)"
      },
      {
        "name": "go_pro",
        "type": "INTEGER",
        "constraints": [],
        "description": "Boolean flag: GoPro action camera (1=true, 0=false, NULL=unknown)"
      },
      {
        "name": "dash_cam",
        "type": "INTEGER",
        "constraints": [],
        "description": "Boolean flag: dashboard camera (1=true, 0=false, NULL=unknown)"
      },
      {
        "name": "other",
        "type": "INTEGER",
        "constraints": [],
        "description": "Boolean flag: uncategorized hardware (1=true, 0=false, NULL=unknown) - includes live videos"
      },
      {
        "name": "ffmpeg_hardware",
        "type": "TEXT",
        "constraints": [],
        "description": "Raw metadata from ffprobe (JSON format)"
      },
      {
        "name": "vid_hardware",
        "type": "TEXT",
        "constraints": [],
        "description": "Parsed hardware info (JSON1): {make, model, category}"
      },
      {
        "name": "loc_uuid",
        "type": "TEXT",
        "constraints": ["NOT NULL"],
        "description": "Parent location UUID - foreign key to locations.loc_uuid"
      },
      {
        "name": "sub_uuid",
        "type": "TEXT",
        "constraints": [],
        "description": "Parent sub-location UUID - foreign key to sub_locations.sub_uuid (nullable)"
      },
      {
        "name": "vid_loco",
        "type": "TEXT",
        "constraints": [],
        "description": "Original video folder location (absolute path) before import"
      },
      {
        "name": "vid_nameo",
        "type": "TEXT",
        "constraints": [],
        "description": "Original video filename before import"
      },
      {
        "name": "vid_add",
        "type": "TEXT",
        "constraints": [],
        "description": "Date added to database - normalized with dateutil (ISO 8601)"
      },
      {
        "name": "vid_update",
        "type": "TEXT",
        "constraints": [],
        "description": "Date last updated - normalized with dateutil (ISO 8601)"
      },
      {
        "name": "imp_author",
        "type": "TEXT",
        "constraints": [],
        "description": "Import author username"
      },
      {
        "name": "vid_docs",
        "type": "TEXT",
        "constraints": [],
        "description": "Related documents to this video (JSON1 array of doc_sha256)"
      },
      {
        "name": "vid_imgs",
        "type": "TEXT",
        "constraints": [],
        "description": "Related images to this video (JSON1 array of img_sha256) - for live videos"
      }
    ],

    "foreign_keys": [
      {
        "column": "loc_uuid",
        "references": "locations(loc_uuid)",
        "on_delete": "CASCADE",
        "description": "Parent location - cascade delete when location is deleted"
      },
      {
        "column": "sub_uuid",
        "references": "sub_locations(sub_uuid)",
        "on_delete": "SET NULL",
        "description": "Parent sub-location - set to NULL when sub-location is deleted"
      }
    ],

    "indexes": [
      {
        "name": "idx_videos_loc_uuid",
        "columns": ["loc_uuid"],
        "description": "Index for queries by location"
      },
      {
        "name": "idx_videos_drone",
        "columns": ["loc_uuid", "drone"],
        "description": "Index for filtering by location and drone videos"
      }
    ]
  },

  "notes": [
    "vid_sha8 (first 8 chars) is computed when needed using sha256[:8]",
    "Hardware categorization based on ffprobe Make/Model matched against camera_hardware.json",
    "Live videos are matched to live photos and stored in videos/original_other folder",
    "Boolean flags start as NULL, set during db_organize.py processing"
  ]
}
